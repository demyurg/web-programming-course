<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LR9: Database & Business Logic - Scoring Algorithm</title>
    <link rel="stylesheet" href="reset.css" />
    <link rel="stylesheet" href="reveal.css" />
    <link rel="stylesheet" href="black.css" />
    <link rel="stylesheet" href="monokai.css" />
    <style>
      .reveal h1,
      .reveal h2,
      .reveal h3 {
        text-transform: none;
      }
      .reveal pre {
        width: 100%;
        font-size: 0.55em;
      }
      .reveal code {
        padding: 2px 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
      }
      .highlight-box {
        background: rgba(100, 200, 255, 0.2);
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #64c8ff;
        margin: 20px 0;
      }
      .two-columns {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        text-align: left;
      }
      .success-box {
        background: rgba(100, 255, 100, 0.2);
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #64ff64;
        margin: 20px 0;
      }
      .reveal ul {
        text-align: left;
      }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <!-- Slide 1: Title -->
        <section>
          <h1>LR9: Database & Business Logic</h1>
          <h3>Scoring Algorithm</h3>
          <p style="font-size: 0.9em; margin-top: 40px">
            –¢–µ–æ—Ä–∏—è Advanced Backend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
          </p>
        </section>

        <!-- Slide 2: Agenda -->
        <section>
          <h2>–ü–ª–∞–Ω</h2>
          <ul style="font-size: 0.9em">
            <li><strong>–ß–∞—Å—Ç—å 0:</strong> –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞</li>
            <li><strong>–ß–∞—Å—Ç—å 1:</strong> Advanced Prisma</li>
            <li><strong>–ß–∞—Å—Ç—å 2:</strong> Scoring Algorithm</li>
            <li><strong>–ß–∞—Å—Ç—å 3:</strong> –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ</li>
            <li><strong>–ß–∞—Å—Ç—å 4:</strong> Admin endpoints</li>
          </ul>
        </section>

        <!-- Slide 3: Context -->
        <section>
          <h2>LR8 –∫–æ–Ω—Ç–µ–∫—Å—Ç</h2>
          <div class="two-columns" style="font-size: 0.85em">
            <div>
              <h4>‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è</h4>
              <ul>
                <li>REST API endpoints</li>
                <li>Prisma schema</li>
                <li>JWT —Ç–æ–∫–µ–Ω—ã</li>
                <li>Basic CRUD</li>
              </ul>
            </div>
            <div>
              <h4>‚ùå –î–∞–ª–µ–µ</h4>
              <ul>
                <li>–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞</li>
                <li>–ü–æ–¥—Å—á—ë—Ç –±–∞–ª–ª–æ–≤</li>
                <li>Admin –∫–æ–Ω—Ç—Ä–æ–ª—å</li>
                <li>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Slide 4: Project Architecture -->
        <section>
          <h2>Project Architecture</h2>
          <p style="text-align: left; font-size: 0.85em; margin-bottom: 15px">
            –ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∫–æ–¥ –≤ backend –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
          </p>

          <pre style="font-size: 0.5em; text-align: left"><code>quiz-backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts          # Entry point
‚îÇ   ‚îú‚îÄ‚îÄ routes/           # HTTP handlers (req/res)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sessions.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin.ts
‚îÇ   ‚îú‚îÄ‚îÄ services/         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scoringService.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sessionService.ts
‚îÇ   ‚îú‚îÄ‚îÄ middleware/       # JWT, validation
‚îÇ   ‚îî‚îÄ‚îÄ utils/            # Helpers
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma     # Database models</code></pre>

          <div class="highlight-box" style="margin-top: 20px; font-size: 0.8em">
            <strong>–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:</strong> –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
            <ul style="margin-top: 10px">
              <li>
                <strong>routes/</strong> ‚Äî HTTP —Å–ª–æ–π (status codes, headers)
              </li>
              <li>
                <strong>services/</strong> ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (scoring, validation)
              </li>
            </ul>
          </div>
        </section>

        <!-- Slide 5: Service Layer Pattern -->
        <section>
          <h2>Service Layer Pattern</h2>
          <p style="text-align: left; margin-bottom: 15px">
            –ó–∞—á–µ–º –≤—ã–Ω–æ—Å–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã?
          </p>

          <div class="two-columns" style="font-size: 0.75em">
            <div>
              <h4 style="color: #ff6b6b">‚ùå –ü–ª–æ—Ö–æ: –ª–æ–≥–∏–∫–∞ –≤ route</h4>
              <pre
                style="font-size: 0.65em"
              ><code class="language-typescript">app.post('/score', async (c) => {
  const { answers, correct } =
    await c.req.json();

  let score = 0;
  for (const ans of answers) {
    if (correct.includes(ans))
      score += 1;
    else
      score -= 0.5;
  }

  await prisma.session.update({...});

  return c.json({ score });
});</code></pre>
            </div>

            <div>
              <h4 style="color: #64ff64">‚úÖ –•–æ—Ä–æ—à–æ: service –¥–µ–ª–∞–µ—Ç —Ä–∞–±–æ—Ç—É</h4>
              <pre
                style="font-size: 0.65em"
              ><code class="language-typescript">app.post('/score', async (c) => {
  const { answers, correct } =
    await c.req.json();

  const score = scoringService
    .scoreMultipleSelect(
      correct, answers
    );

  await sessionService
    .updateScore(sessionId, score);

  return c.json({ score });
});</code></pre>
            </div>
          </div>

          <div class="success-box" style="margin-top: 15px; font-size: 0.8em">
            <strong>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</strong>
            <ul>
              <li>‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å (–±–µ–∑ HTTP)</li>
              <li>‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</li>
              <li>‚úÖ –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å</li>
            </ul>
          </div>
        </section>

        <!-- Slide 6: Dependency Injection -->
        <section>
          <h2>Dependency Injection</h2>
          <p style="text-align: left; font-size: 0.85em; margin-bottom: 15px">
            –ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏?
          </p>

          <div class="two-columns" style="font-size: 0.65em">
            <div>
              <h4 style="margin-bottom: 8px">–ú–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–æ–µ–∫—Ç (LR9)</h4>
              <pre
                style="font-size: 0.6em; margin: 0"
              ><code class="language-typescript">// Singleton
const prisma =
  new PrismaClient();

// routes/sessions.ts
import { prisma }
  from '../services';

app.post('/sessions',
  async (c) => {
  const session =
    await prisma.session
      .create({...});
  return c.json({session});
});</code></pre>
              <p style="margin: 5px 0 0 0">‚úÖ –ü—Ä–æ—Å—Ç–æ</p>
            </div>

            <div>
              <h4 style="margin-bottom: 8px">–ë–æ–ª—å—à–æ–π –ø—Ä–æ–µ–∫—Ç</h4>
              <pre
                style="font-size: 0.55em; margin: 0"
              ><code class="language-typescript">class Container {
  prisma = new PrismaClient();
  scoringService =
    new ScoringService();
  sessionService =
    new SessionService(
      this.prisma,
      this.scoringService
    );
}

@Injectable()
class SessionService {
  constructor(
    private prisma,
    private scoring
  ) {}
}</code></pre>
              <p style="margin: 5px 0 0 0">‚úÖ –ì–∏–±–∫–æ</p>
            </div>
          </div>

          <div
            class="highlight-box"
            style="margin-top: 15px; font-size: 0.8em; padding: 12px 15px"
          >
            <strong>–î–ª—è LR9:</strong> –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–µ–≤—ã–π –ø–æ–¥—Ö–æ–¥
          </div>
        </section>

        <!-- Slide 7: Best Practices -->
        <section>
          <h2 style="margin-bottom: 15px">Best Practices</h2>

          <div class="success-box" style="font-size: 0.72em; padding: 15px">
            <ol style="text-align: left; margin: 0">
              <li style="margin-bottom: 8px">
                ‚úÖ <strong>–û–¥–∏–Ω —Ñ–∞–π–ª –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</strong>
                <pre
                  style="font-size: 0.6em; margin: 4px 0"
                ><code>// src/services/index.ts
export const prisma = new PrismaClient();
export const scoringService = new ScoringService();
export const sessionService = new SessionService(
  prisma, scoringService);</code></pre>
              </li>

              <li style="margin-bottom: 8px">
                ‚úÖ <strong>Routes –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç —Å–µ—Ä–≤–∏—Å—ã</strong>
                <pre
                  style="font-size: 0.6em; margin: 4px 0"
                ><code>import { sessionService } from '../services';
app.post('/sessions', async (c) => {
  const result = await sessionService
    .createSession(...);
  return c.json(result);
});</code></pre>
              </li>

              <li>
                ‚úÖ <strong>–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å</strong>
                <pre
                  style="font-size: 0.6em; margin: 4px 0"
                ><code>const service = new ScoringService();
const score = service.scoreMultipleSelect(
  ['A','C'], ['A','B','C']);
expect(score).toBe(1.5);</code></pre>
              </li>
            </ol>
          </div>
        </section>

        <!-- Slide 8: Advanced Prisma - Relationships -->
        <section>
          <h2>Advanced Prisma: Relationships</h2>
          <p style="text-align: left; font-size: 0.85em">
            –¢—Ä–∏ —Ç–∏–ø–∞ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏:
          </p>
          <ul style="font-size: 0.85em">
            <li><strong>One-to-Many:</strong> User ‚Üí –º–Ω–æ–≥–æ Sessions</li>
            <li><strong>Many-to-Many:</strong> Question ‚Üí –º–Ω–æ–≥–æ Tags</li>
            <li><strong>One-to-One:</strong> User ‚Üí Profile</li>
          </ul>
          <pre
            style="margin-top: 20px; font-size: 0.5em"
          ><code class="language-typescript">model User {
  id       String
  sessions Session[]  // –æ–¥–∏–Ω User -> –º–Ω–æ–≥–æ Sessions
}

model Session {
  userId String
  user   User @relation(fields: [userId], references: [id])
}</code></pre>
        </section>

        <!-- Slide 5: Transactions -->
        <section>
          <h2>Transactions (–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)</h2>
          <p style="text-align: left; margin-bottom: 20px">
            –õ–∏–±–æ –í–°–ï –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, –ª–∏–±–æ –ù–ò–ß–ï–ì–û:
          </p>
          <pre
            style="font-size: 0.5em"
          ><code class="language-typescript">const result = await prisma.$transaction(async (tx) => {
  // –®–∞–≥ 1: —Å—á–∏—Ç–∞–µ–º –±–∞–ª–ª—ã
  const score = calculateScore(answers);
  
  // –®–∞–≥ 2: –æ–±–Ω–æ–≤–ª—è–µ–º session
  const session = await tx.session.update({
    where: { id: sessionId },
    data: { score }
  });
  
  // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –æ—Ç–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è –û–ë–ï –æ–ø–µ—Ä–∞—Ü–∏–∏!
  return session;
});</code></pre>
          <p style="font-size: 0.8em; margin-top: 15px">
            ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–±–∞–ª–ª—ã, –¥–µ–Ω—é—à–∫–∏)
          </p>
        </section>

        <!-- Slide 6: Performance Optimization -->
        <section>
          <h2>Performance Optimization</h2>
          <div class="highlight-box" style="font-size: 0.75em">
            <strong>‚ùå –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ:</strong>
            <p>10,000 sessions √ó 500 bytes = 5 MB</p>
          </div>
          <div class="highlight-box" style="font-size: 0.75em">
            <strong>‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ:</strong>
            <p>10,000 sessions √ó 50 bytes = 500 KB</p>
          </div>
          <pre
            style="font-size: 0.5em; margin-top: 15px"
          ><code class="language-typescript">// Select —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
const sessions = await prisma.session.findMany({
  select: {
    id: true,
    score: true
    // –ù–ï –∑–∞–≥—Ä—É–∂–∞–µ–º answers, updatedAt, etc.
  }
});</code></pre>
        </section>

        <!-- Slide 7: Scoring Algorithm - Multiple Select -->
        <section>
          <h2>Scoring: Multiple-Select</h2>
          <p style="text-align: left; font-size: 0.85em">
            <strong>–ü—Ä–∞–≤–∏–ª–∞:</strong>
          </p>
          <ul style="font-size: 0.8em">
            <li>–ó–∞ –∫–∞–∂–¥—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: <strong>+1 –±–∞–ª–ª</strong></li>
            <li>–ó–∞ –∫–∞–∂–¥—ã–π –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: <strong>-0.5 –±–∞–ª–ª–∞</strong></li>
            <li>–ú–∏–Ω–∏–º—É–º: <strong>0 –±–∞–ª–ª–æ–≤</strong></li>
          </ul>
          <div style="margin-top: 20px; text-align: left; font-size: 0.8em">
            <p><strong>–ü—Ä–∏–º–µ—Ä:</strong></p>
            <p>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ: [A, C, D]</p>
            <p>–°—Ç—É–¥–µ–Ω—Ç –≤—ã–±—Ä–∞–ª: [A, B, C]</p>
            <p>–†–∞—Å—á—ë—Ç: +1 (A) -0.5 (B) +1 (C) = <strong>1.5 –±–∞–ª–ª–æ–≤</strong></p>
          </div>
        </section>

        <!-- Slide 8: Scoring - Implementation -->
        <section>
          <h2>Scoring: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è</h2>
          <pre
            style="font-size: 0.5em"
          ><code class="language-typescript">function scoreMultipleSelect(
  correctAnswers: string[],
  studentAnswers: string[]
): number {
  let score = 0;

  for (const answer of studentAnswers) {
    if (correctAnswers.includes(answer)) {
      score += 1;      // –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
    } else {
      score -= 0.5;    // –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
    }
  }

  return Math.max(0, score);  // –º–∏–Ω–∏–º—É–º 0
}

// –¢–µ—Å—Ç—ã
scoreMultipleSelect(['A','C','D'], ['A','C']);      // 2
scoreMultipleSelect(['A','C','D'], ['A','B','C']);  // 1.5
scoreMultipleSelect(['A','C','D'], ['B','E']);      // 0</code></pre>
        </section>

        <!-- Slide 9: Essay Scoring -->
        <section>
          <h2>Scoring: Essay Questions</h2>
          <p style="text-align: left; margin-bottom: 15px">
            Essay —Ç—Ä–µ–±—É–µ—Ç <strong>—Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏</strong> –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–º.
          </p>
          <p style="text-align: left; font-size: 0.85em">
            –ò—Å–ø–æ–ª—å–∑—É–µ–º <strong>Rubric</strong> (–∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏):
          </p>
          <ul style="font-size: 0.8em">
            <li>Clarity (–ø–æ–Ω–∏–º–∞–Ω–∏–µ): 3 –±–∞–ª–ª–∞</li>
            <li>Examples (–ø—Ä–∏–º–µ—Ä—ã): 2 –±–∞–ª–ª–∞</li>
            <li>Detail (–¥–µ—Ç–∞–ª–∏): 2 –±–∞–ª–ª–∞</li>
            <li>Code (–∫–æ–¥): 3 –±–∞–ª–ª–∞</li>
          </ul>
          <p style="margin-top: 20px; font-size: 0.8em">
            –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –±–∞–ª–ª—ã –ø–æ –∫–∞–∂–¥–æ–º—É –∫—Ä–∏—Ç–µ—Ä–∏—é ‚Üí —Å—É–º–º–∞ =
            —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±–∞–ª–ª
          </p>
        </section>

        <!-- Slide 10: Session Management -->
        <section>
          <h2>Session Management</h2>
          <p style="text-align: left">–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∫–≤–∏–∑-—Å–µ—Å—Å–∏–∏:</p>
          <pre
            style="font-size: 0.5em; text-align: center"
          ><code>START ‚Üí in_progress ‚Üí SUBMIT ‚Üí completed
        ‚Üì
        TIMEOUT ‚Üí expired</code></pre>
          <div style="margin-top: 20px; font-size: 0.8em; text-align: left">
            <p><strong>–ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º:</strong></p>
            <ul>
              <li>status: "in_progress", "completed", "expired"</li>
              <li>expiresAt: –∫–æ–≥–¥–∞ –∏—Å—Ç–µ—á—ë—Ç –≤—Ä–µ–º—è (1 —á–∞—Å)</li>
              <li>score: —Ä–µ–∑—É–ª—å—Ç–∞—Ç (null –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞)</li>
              <li>answers: –≤—Å–µ –æ—Ç–≤–µ—Ç—ã —Å—Ç—É–¥–µ–Ω—Ç–∞</li>
            </ul>
          </div>
        </section>

        <!-- Slide 11: Validation -->
        <section>
          <h2>–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ</h2>
          <p style="text-align: left; margin-bottom: 15px">
            –í—Å–µ–≥–¥–∞ –≤–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ! –§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω.
          </p>
          <pre
            style="font-size: 0.5em"
          ><code class="language-typescript">import { z } from 'zod';

const AnswerSchema = z.object({
  questionId: z.string().uuid(),
  userAnswer: z.array(z.string()),
  sessionId: z.string().uuid()
});

app.post('/api/answers', async (c) => {
  const parsed = AnswerSchema.safeParse(await c.req.json());
  if (!parsed.success) {
    return c.json({ error: parsed.error }, 400);
  }
  // –î–∞–ª—å—à–µ —Ä–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —Å valididated data
});</code></pre>
        </section>

        <!-- Slide 12: Admin Endpoints -->
        <section>
          <h2>Admin Endpoints</h2>
          <p style="text-align: left; font-size: 0.85em">Admin –º–æ–∂–µ—Ç:</p>
          <ul style="font-size: 0.85em">
            <li>‚úèÔ∏è –°–æ–∑–¥–∞–≤–∞—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã</li>
            <li>üìù –ü—Ä–æ–≤–µ—Ä—è—Ç—å essay –æ—Ç–≤–µ—Ç—ã</li>
            <li>üìä –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</li>
            <li>üíæ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</li>
          </ul>
          <pre
            style="font-size: 0.5em; margin-top: 15px"
          ><code class="language-typescript">// –¢—Ä–µ–±—É–µ–º admin —Ä–æ–ª—å
function requireAdmin(c: Context) {
  const user = c.get('user');
  if (user.role !== 'admin') {
    throw new Unauthorized("Admin only");
  }
}</code></pre>
        </section>

        <!-- Slide 13: Admin - Grading -->
        <section>
          <h2>Admin: –û—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ Essay</h2>
          <pre
            style="font-size: 0.5em"
          ><code class="language-typescript">app.post('/api/admin/answers/:id/grade', async (c) => {
  const { score, feedback } = await c.req.json();

  return await prisma.$transaction(async (tx) => {
    // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–≤–µ—Ç —Å –æ—Ü–µ–Ω–∫–æ–π
    const answer = await tx.answer.update({
      where: { id },
      data: { score, feedback }
    });

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –≤ —Å–µ—Å—Å–∏–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
    const session = await tx.session.findUnique({
      where: { id: answer.sessionId },
      include: { answers: true }
    });

    // –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã - –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π score
    if (session.answers.every(a => a.score !== null)) {
      const total = session.answers.reduce(
        (s, a) => s + (a.score || 0), 0
      );
      await tx.session.update({
        where: { id },
        data: { score: total, status: "completed" }
      });
    }

    return answer;
  });
});</code></pre>
        </section>

        <!-- Slide 14: Batch Operations -->
        <section>
          <h2>Batch Operations</h2>
          <p style="text-align: left; margin-bottom: 15px">
            –°–æ–∑–¥–∞–≤–∞—Ç—å –º–Ω–æ–≥–æ –∑–∞–ø–∏—Å–µ–π –æ–¥–Ω–∏–º query:
          </p>
          <pre
            style="font-size: 0.5em"
          ><code class="language-typescript">// ‚ùå –ü–ª–æ—Ö–æ: 1000 queries
for (const q of questions) {
  await prisma.question.create({ data: q });
}

// ‚úÖ –•–æ—Ä–æ—à–æ: 1 query
await prisma.question.createMany({
  data: questions,
  skipDuplicates: true
});

// –¢–∞–∫–∂–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
await prisma.answer.updateMany({
  where: { sessionId: "s1" },
  data: { status: "graded" }
});</code></pre>
        </section>

        <!-- Slide 15: Database Optimization -->
        <section>
          <h2>Database Optimization</h2>
          <p style="text-align: left; font-size: 0.9em">–¢—Ä–∏ –≤–∞–∂–Ω—ã—Ö —Ç–µ—Ö–Ω–∏–∫–∏:</p>
          <ol style="font-size: 0.85em">
            <li>
              <strong>–ò–Ω–¥–µ–∫—Å—ã:</strong> @@index([userId]) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
            </li>
            <li>
              <strong>–ü–∞–≥–∏–Ω–∞—Ü–∏—è:</strong> skip, take –≤–º–µ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ–≥–æ
            </li>
            <li>
              <strong>Select/Include:</strong> –≤—ã–±–∏—Ä–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
            </li>
          </ol>
          <pre
            style="font-size: 0.5em; margin-top: 15px"
          ><code class="language-prisma">model Session {
  id        String @id
  userId    String
  status    String
  createdAt DateTime

  @@index([userId])           // –∏–Ω–¥–µ–∫—Å –Ω–∞ userId
  @@index([userId, status])   // –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å
}</code></pre>
        </section>

        <!-- Slide 16: Pagination -->
        <section>
          <h2>Pagination</h2>
          <p style="text-align: left; margin-bottom: 15px">
            –ù–µ –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ 10,000 –∑–∞–ø–∏—Å–µ–π —Å—Ä–∞–∑—É!
          </p>
          <pre
            style="font-size: 0.5em"
          ><code class="language-typescript">const page = 1;
const limit = 20;

const sessions = await prisma.session.findMany({
  skip: (page - 1) * limit,
  take: limit,
  orderBy: { createdAt: 'desc' }
});

const total = await prisma.session.count();
const pages = Math.ceil(total / limit);

return { data: sessions, pagination: { page, limit, total, pages } };</code></pre>
        </section>

        <!-- Slide 17: Best Practices Summary -->
        <section>
          <h2>Best Practices</h2>
          <div class="success-box">
            <ol style="font-size: 0.85em; text-align: left">
              <li>‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <strong>relationships</strong> –¥–ª—è —Å–≤—è–∑–µ–π</li>
              <li>
                ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ queries —Å <strong>select/include</strong>
              </li>
              <li>
                ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <strong>transactions</strong> –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö
                –æ–ø–µ—Ä–∞—Ü–∏–π
              </li>
              <li>‚úÖ –í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –í–°–Å —Å <strong>Zod</strong></li>
              <li>‚úÖ –ó–∞—â–∏—â–∞–π—Ç–µ endpoints <strong>middleware</strong></li>
              <li>
                ‚úÖ –î–æ–±–∞–≤–ª—è–π—Ç–µ <strong>–∏–Ω–¥–µ–∫—Å—ã</strong> –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö
                –ø–æ–ª–µ–π
              </li>
            </ol>
          </div>
        </section>

        <!-- Slide 18: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä -->
        <section>
          <h2>–ü–æ–ª–Ω—ã–π –°—Ü–µ–Ω–∞—Ä–∏–π</h2>
          <div style="text-align: left; font-size: 0.8em">
            <p><strong>–°—Ç—É–¥–µ–Ω—Ç –ò–≤–∞–Ω:</strong></p>
            <ol>
              <li>–ù–∞–∂–∏–º–∞–µ—Ç "Start" ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è Session</li>
              <li>–û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ multiple-select ‚Üí score —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É</li>
              <li>–û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ essay ‚Üí score=null (–∂–¥—ë—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏)</li>
              <li>–ù–∞–∂–∏–º–∞–µ—Ç "Submit" ‚Üí transaction –æ–±–Ω–æ–≤–ª—è–µ—Ç Session</li>
            </ol>
            <p style="margin-top: 15px"><strong>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ê–Ω–Ω–∞:</strong></p>
            <ol>
              <li>–í–∏–¥–∏—Ç essay –æ—Ç–≤–µ—Ç –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏</li>
              <li>–ß–∏—Ç–∞–µ—Ç –∏ –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ü–µ–Ω–∫—É 8 –∏–∑ 10</li>
              <li>Backend: –æ–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π score</li>
            </ol>
          </div>
        </section>

        <!-- Slide 19: –†–µ–∑—é–º–µ -->
        <section>
          <h2>–†–µ–∑—é–º–µ</h2>
          <div class="success-box">
            <ul style="font-size: 0.85em">
              <li>‚úÖ Advanced Prisma (relationships, transactions)</li>
              <li>‚úÖ Scoring Algorithm (multiple-select, essay)</li>
              <li>‚úÖ Session Management (–∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª)</li>
              <li>‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Zod)</li>
              <li>‚úÖ Admin endpoints (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ)</li>
              <li>‚úÖ Database optimization (–∏–Ω–¥–µ–∫—Å—ã, –ø–∞–≥–∏–Ω–∞—Ü–∏—è)</li>
            </ul>
          </div>
        </section>

        <!-- Slide 20: –î–∞–ª–µ–µ - –ù–∞ —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–µ -->
        <section>
          <h2>–ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ</h2>
          <div class="highlight-box" style="font-size: 0.85em">
            <ol style="text-align: left">
              <li>–†–µ–∞–ª–∏–∑—É–µ—Ç–µ scoring functions</li>
              <li>–û–±–Ω–æ–≤–∏—Ç–µ Prisma schema —Å relationships</li>
              <li>–î–æ–±–∞–≤–∏—Ç–µ Session –ª–æ–≥–∏–∫—É –≤ endpoints</li>
              <li>–†–µ–∞–ª–∏–∑—É–µ—Ç–µ admin endpoints</li>
              <li>–î–æ–±–∞–≤–∏—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å Zod</li>
            </ol>
          </div>
          <p style="margin-top: 30px">
            –ë–µ—Ä–µ–º backend LR8 –∏ –≤–∂—É—Ö –ø–æ—á—Ç–∏ production!
          </p>
        </section>
      </div>
    </div>

    <script src="reveal.js"></script>
    <script src="markdown.js"></script>
    <script src="highlight.js"></script>
    <script src="notes.js"></script>
    <script>
      Reveal.initialize({
        hash: true,
        highlight: {
          beforeHighlight: (hljs) => {
            hljs.getLanguage("typescript") && hljs.getLanguage("typescript");
          },
        },
        plugins: [RevealHighlight],
        slideNumber: true,
        transition: "slide",
        backgroundTransition: "fade",
      });
    </script>
  </body>
</html>
